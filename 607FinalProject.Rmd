---
title: "Data 607 Final Project"
output: html_document
---

```{r}
print("Christophe")
```


## Twitter search

Need to run only this chunk (`Twitter Setup`) first because you need to put in a PIN given by Twitter.  

```{r, Twitter Setup}
library(twitteR)
library(httr)

consumer_key <- "needs_keys_from_slack"
consumer_secret <- "needs_keys_from_slack"
access_token <- "needs_keys_from_slack"
access_secret <- "needs_keys_from_slack"

download.file(url='http://curl.haxx.se/ca/cacert.pem', destfile='cacert.pem')
reqURL <- 'https://api.twitter.com/oauth/request_token'
accessURL <- 'https://api.twitter.com/oauth/access_token'
authURL <- 'https://api.twitter.com/oauth/authorize'
Cred <- OAuthFactory$new(consumerKey=consumer_key,
                         consumerSecret=consumer_secret,
                         requestURL=reqURL,
                         accessURL=accessURL,
                         authURL=authURL)

Cred$handshake(cainfo = system.file('CurlSSL', 
                                    'cacert.pem', 
                                    package = 'RCurl'))
```

Now run the following chunks after entering the PIN for Twitter Authorization.

```{r}
save(Cred, file='twitter authentication.Rdata')
load('twitter authentication.Rdata') 
setup_twitter_oauth(consumer_key, 
                    consumer_secret, 
                    access_token, 
                    access_secret)
```

This chunk gets the twitter search results for a term, `searchTwitter` has some other settings that could probably improve results.

```{r, Searching Twitter}
search_term <- function(term){
  search_term <- gsub(" ", "+", term)
  return(search_term)
}
  
SearchTerm <- search_term("BarberShop: The Next Cut")
list <- searchTwitter(SearchTerm, n = 100)
df <- twListToDF(list)
```

```{r, sentiment analysis}
library(knitr)
#http://www.inside-r.org/howto/mining-twitter-airline-consumer-sentiment
pos.words = scan('http://www.idiap.ch/~apbelis/hlt-course/positive-words.txt',what='character', comment.char=';')
neg.words = scan('http://www.idiap.ch/~apbelis/hlt-course/negative-words.txt',what='character', comment.char=';')

score.sentiment = function(tweets, pos.words, neg.words)
{
scores = laply(tweets, function(tweets, pos.words, neg.words) {
word.list = str_split(tweets, '\\s+')
words = unlist(word.list)
pos.matches = match(words, pos.words)
neg.matches = match(words, neg.words)
pos.matches = !is.na(pos.matches)
neg.matches = !is.na(neg.matches)
score = sum(pos.matches) - sum(neg.matches)

return(score)
}, pos.words, neg.words)

scores.df = data.frame(score=scores, text=tweets)
return(scores.df)
}

rm_special <-function(x) iconv(x, "UTF-8", "UTF-8",sub='')

df_tweet_score <- as.data.frame(score.sentiment(as.character(rm_special(df$text)), pos.words, neg.words))
kable(df_tweet_score)
```
